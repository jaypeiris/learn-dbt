{
  "id": "materialization-mastery",
  "title": "Materialization Decisions",
  "description": "Choose the right materialization based on model purpose and usage",
  "challenges": [
    {
      "id": "choose-view-vs-table",
      "type": "choose_materialization",
      "title": "View vs Table decision",
      "difficulty": "beginner",
      "timeEstimate": "5 min",
      "description": "This lightweight model is queried frequently. What materialization makes sense?",
      "scenario": "A BI dashboard queries this model every 5 minutes. It's simple SQL but gets hit constantly.",
      "starterSql": "-- This model is queried every 5 minutes by dashboards\n-- It's lightweight (< 100 rows) but frequently accessed\n-- Choose the right materialization\n\nselect\n  status,\n  count(*) as order_count,\n  sum(total) as revenue\nfrom {{ ref('orders') }}\nwhere created_at >= current_date\ngroup by status",
      "checks": [
        {
          "type": "materialization",
          "value": "table",
          "hint": "Frequent queries benefit from pre-computed tables"
        }
      ],
      "explanation": "Even though it's small, the frequent access makes 'table' better than 'view'. The query runs once during dbt run, not thousands of times daily.",
      "hint": "Add {{ config(materialized='table') }} at the top",
      "tags": ["materialization", "table", "performance"]
    },
    {
      "id": "choose-incremental",
      "type": "choose_materialization",
      "title": "When to use incremental",
      "difficulty": "intermediate",
      "timeEstimate": "10 min",
      "description": "Large event data that grows daily needs the right materialization strategy",
      "scenario": "This model processes billions of clickstream events. Full rebuilds take hours.",
      "starterSql": "-- Clickstream events: billions of rows, grows daily\n-- Full rebuild takes 4+ hours\n-- Only need to process new events each run\n-- Choose the right approach\n\nselect\n  event_id,\n  user_id,\n  event_type,\n  occurred_at,\n  properties\nfrom {{ ref('stg_events') }}\nwhere event_type in ('page_view', 'click', 'conversion')",
      "checks": [
        {
          "type": "materialization",
          "value": "incremental",
          "hint": "Large, append-only data benefits from incremental builds"
        },
        {
          "type": "contains_text",
          "value": "is_incremental()",
          "hint": "Add a filter using is_incremental() macro"
        }
      ],
      "explanation": "Incremental materialization only processes new rows, reducing build time from hours to minutes.",
      "hint": "Use {{ config(materialized='incremental') }} and add {% if is_incremental() %} filter",
      "tags": ["materialization", "incremental", "performance", "big-data"]
    }
  ]
}
